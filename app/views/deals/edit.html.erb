<% provide(:title, "Editar Deal") %>
<h1>Deal con <span class="titulo-empresa"><%= @deal.empresa %></span></h1>
<div class="row edit">
  <div class="col-md-6 col-md-offset-3">

    <%= form_for(@deal) do |f| %>
    
    <%= render 'shared/error_messages', object: f.object %>
    
    <div class="form-group"> 
      <%= f.label :fuente, "Fuente del contacto" %>
      <%= f.text_field :fuente, class: 'form-control'  %>
    </div>
    <div class="form-group"> 
      <%= f.label :producto_id, "Producto" %>
      <%= f.select :producto_id, Producto.all.collect { |p| [p.nombre, p.id] }, class: 'form_control' %>
    </div>
    <div class="form-group"> 
      <%= f.label :estado, "Estado" %>
      <%= f.select :estado, ["Ganado", "Perdido", "En espera", "Trabajo contratado"], class: 'form-control' %>
    </div>
    <div class="form-group"> 
      <%= f.label :probabilidad, "Probabilidad" %>
      <%= f.number_field :probabilidad, step:10 , class: 'form-control' %>
    </div>
    <%= f.submit "Guardar", class: "btn btn-primary" %>
    <% end %>
    <%= button_to "Eliminar deal", @deal, method: :delete, data: { confirm: "Â¿Seguro?" }, class: "btn btn-danger" %>

    <div> 
      <div id="companeros-edit" class="full-width">
	<span class="titulo-compa">Participan</span>
	<span class="titulo-compa">No participan</span>
      </div>
      <% User.where('id != ?', @deal.user.id).each do |u| %>
        <% if not @deal.cousers.include?(u) %>
          <%= form_for(@deal.participacions.build) do |f| %>
	    <div><%= hidden_field_tag :user_id, u.id %></div>
	    <div><%= hidden_field_tag :deal_id, @deal.id %></div>
	    <%= f.submit u.name, class: "btn btn-invitar btn-compa no_participa" %>
	  <% end %>
	<% else %>  
	  <%= form_for(@deal.participacions.find_by(user_id: u.id), html: { method: :delete } ) do |f| %>
	    <%= f.submit u.name, class: "btn btn-echar btn-compa participa" %>
	  <% end %>
	<% end %>
      <% end %>
    </div>
  </div>
</div>
